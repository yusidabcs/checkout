/*
 * jQuery Pines Steps (psteps) Plugin 0.0.1alpha
 *
 * http://pinesframework.org/psteps/
 * Copyright (c) 2012 Angela Murrell
 *
 * Triple license under the GPL, LGPL, and MPL:
 *	  http://www.gnu.org/licenses/gpl.html
 *	  http://www.gnu.org/licenses/lgpl.html
 *	  http://www.mozilla.org/MPL/MPL-1.1.html
 */
(function(f){f.fn.psteps=function(o){var c=f.extend({},f.fn.psteps.defaults,o);this.each(function(){var a=f(this);a.psteps_version="0.0.1alpha";if(a.hasClass("steps-transformed"))return true;a.addClass("steps-transformed");a.opts=c;var h=a.find(".step-content"),p=a.find(".step-title"),o=a.find(".step-name"),k=a.find(".next-button"),i=a.find(".back-button"),j=a.find(".submit-button"),l=a.find(".next-button, .submit-button"),r=a.find(".step-title").length,m=true;a.get_max_height=function(a){var c=-1;
a.each(function(){var a=f(this).height();c=a>c?a:c});return c};c.step_order||a.find(".step-order").hide();a.make_step_content_headings=function(){a.find(".step-title").each(function(b){var e=f(this).find(".step-name"),b=a.find(".step-content").eq(b);if(e.length==1){var d=c.content_headings_hr?"<hr/>":"",e='<div class="step-content-name"><'+c.content_headings_element+">"+e.html()+"</"+c.content_headings_element+">"+d+"</div>";c.content_headings_after!=false&&b.find(c.content_headings_after).length>
0?b.find(c.content_headings_after).after(e):b.prepend(e)}})};if(c.content_height_equalize||c.steps_height_equalize||c.steps_width_percentage||c.shrink_step_names){if(c.steps_height_equalize)var n=a.find(".step-title"),t=a.get_max_height(n);if(c.content_height_equalize){n=a.find(".step-content");n.addClass("clearfix");var u=a.get_max_height(n)}f(window).resize(function(){if(c.steps_width_percentage){var b=100/r-1;f(window).width()<parseInt(c.alter_width_at_viewport)&&a.find(".step-title").css({width:b+
"%","padding-left":"0","padding-right":"0"})}c.shrink_step_names&&(f(window).width()<=parseInt(c.alter_names_at_viewport)?setTimeout(function(){a.find(".step-content-name").remove();a.find(".step-name").hide();a.find(".step-order").show();a.make_step_content_headings()},200):setTimeout(function(){a.find(".step-content-name").remove();c.step_order||a.find(".step-order").hide();c.step_names&&a.find(".step-name").show();c.content_headings&&a.make_step_content_headings()},200));c.steps_height_equalize&&
(b=a.find(".step-title"),b.css("min-height",t),b.css("min-height",a.get_max_height(b)));c.content_height_equalize&&setTimeout(function(){var b=a.find(".step-content");b.css("min-height",u);b.css("min-height",a.get_max_height(b))},2E3)}).resize()}a.check_progress_titles=function(){a.find(".step-content").each(function(b){var e=f(this),d="pstep"+(b+1);e.addClass(d);b=a.find(".step-title").eq(b);b.addClass(d);c.traverse_titles=="visited"&&b.hasClass("step-visited")||c.traverse_titles=="custom"&&b.hasClass("step-visited")||
c.traverse_titles=="never"&&b.hasClass("step-visited")||c.traverse_titles=="always"?(d=c.validation_rule.call(e),d=="warning"?(b.removeClass("step-error btn-info btn-success btn-warning btn-danger step-info-error step-info-incomplete").addClass("step-warning step-info-warning"),a.trigger_error(e)):d=="error"?(b.removeClass("step-warning btn-info btn-success btn-warning btn-danger step-info-incomplete step-info-warning").addClass("step-error step-info-error"),a.trigger_error(e)):d?(b.removeClass("step-warning btn-info btn-warning btn-danger step-error step-info-error step-info-incomplete step-info-warning").addClass("btn-success"),
c.check_marks&&b.find("i.step-mark").remove().end().prepend('<i class="icon-ok step-mark"></i> ')):d||b.removeClass("step-warning btn-info btn-success btn-danger btn-warning step-error step-info-error step-info-warning").addClass("btn-info step-info-incomplete").find("i.step-mark").remove()):(d=c.validation_rule.call(e),d=="warning"?b.removeClass("step-info-incomplete step-info-error").addClass("step-info-warning"):d=="error"?(b.removeClass("step-info-incomplete step-info-warning").addClass("step-info-error"),
a.trigger_error(e)):d?b.removeClass("step-info-error step-info-incomplete step-info-warning"):d||b.removeClass("step-info-error step-info-warning").addClass("step-info-incomplete"))});a.toggle_buttons_function();a.trigger("validation_complete.psteps")};a.toggle_buttons_function=function(){var b=k.attr("data-btn-name"),e=j.attr("data-btn-name"),d=i.attr("data-btn-name");b!=void 0&&b.length&&k.html(b);e!=void 0&&e.length&&j.html(e);d!=void 0&&d.length&&i.html(d);a.find(".step-content").last().hasClass("step-active")?
(k.hasClass("btn-manual")||k.hide(),j.hasClass("btn-manual")||j.show()):(k.hasClass("btn-manual")||k.show(),j.hasClass("btn-manual")||j.hide());b=a.find(".step-title.step-active");b.hasClass("btn-success")||b.hasClass("step-warning")?l.removeClass("btn-info").addClass("btn-success"):b.hasClass("btn-info")?l.removeClass("btn-success").addClass("btn-info"):b.hasClass("step-error")&&l.removeClass("btn-success btn-info").addClass("btn-danger");c.validate_submit_all_steps&&(p.filter(".btn-info").length||
p.filter(".step-error").length&&!c.ignore_errors_on_submit)&&j.removeClass("btn-success").addClass("btn-info");c.back?a.find(".step-title").first().hasClass("step-active")?i.hide():(b=a.find(".step-title.step-active").prevAll(".step-title:first"),b.hasClass("btn-info")?i.removeClass("btn-success btn-warning btn-danger").addClass("btn-info").css("cursor","pointer"):b.hasClass("btn-success")?i.removeClass("btn-info btn-warning btn-danger").addClass("btn-success").css("cursor","pointer"):b.hasClass("btn-warning")?
i.removeClass("btn-info btn-success btn-danger").addClass("btn-warning").css("cursor","pointer"):b.hasClass("btn-danger")&&i.removeClass("btn-success btn-warning btn-info").addClass("btn-danger").css("cursor","pointer"),i.show()):i.hide()};a.go_to_step=function(b){var e=a.find(".step-title.last-active"),d=a.find(".step-content.last-active"),q=a.find(".step-content.step-active"),f=a.find(".step-title.step-active");if(!(b>r)){var g=a.find(".step-content").eq(b-1),b=a.find(".step-title").eq(b-1);a.find(".step-resume").length&&
a.find(".step-transition-processing").removeClass("step-transition-processing");f.hasClass("step-transition")&&!a.find(".step-resume").length&&!m&&c.steps_transition.call(q);f.hasClass("step-transition-processing")?(a.find(".step-resume").removeClass("step-resume"),b.addClass("step-resume")):(a.find(".step-resume").removeClass("step-resume"),m||c.steps_hide.call(q),e.removeClass("last-active"),d.removeClass("last-active"),q.hide().removeClass("step-active").addClass("last-active"),g.show().addClass("step-active step-visited"),
f.removeClass("step-active").addClass("disabled last-active"),b.addClass("step-active step-visited").removeClass("disabled"),g.prevAll(".step-content").addClass("step-visited"),b.prevAll(".step-title").addClass("step-visited"),g.hasClass("step-loaded")||c.steps_onload.call(g),g.addClass("step-loaded"),c.steps_show.call(g),c.traverse_titles=="visited"&&b.prevAll(".step-title").andSelf().css("cursor","pointer"),m?m=false:a.trigger("validate.psteps"),a.toggle_buttons_function())}};a.go_to_next_step=
function(){var b=a.find(".step-title.step-active").prevAll(".step-title");if(c.skip_no_traverse_on_next){var e=a.find(".step-title").eq(b.length+1);e.hasClass("step-notraverse")?(b=e.nextAll(".step-title:not(.step-notraverse)").first().prevAll(".step-title").length+1,a.go_to_step(b)):a.go_to_step(b.length+2)}else a.go_to_step(b.length+2)};a.go_to_prev_step=function(){var b=a.find(".step-title.step-active").prevAll(".step-title");a.go_to_step(b.length)};a.change_traverse=function(b){var e=c.custom_traverse_class,
d=a.find(".step-title");a.off("click",".step-title:not(.step-notraverse)");a.off("click",".step-title.step-active:not(.step-notraverse)");a.off("click",".step-title.step-visited:not(.step-notraverse)");b=="always"?(d.css("cursor","pointer"),a.on("click",".step-title:not(.step-notraverse)",function(){var b=f(this).prevAll(".step-title");a.go_to_step(b.length+1)})):b=="custom"?(b=".step-title."+e+":not(.step-notraverse)",d.css("cursor","default").filter("."+e).css("cursor","pointer"),a.on("click",b,
function(){var b=f(this);b.prevAll(".step-title:first").hasClass("step-active")?a.go_to_next_step():b.nextAll(".step-title:first").hasClass("step-active")?a.go_to_prev_step():(b=b.prevAll(".step-title"),a.go_to_step(b.length+1))})):b=="visited"?(d.css("cursor","default").filter(".step-visited").css("cursor","pointer"),a.on("click",".step-title.step-visited:not(.step-notraverse)",function(){var b=f(this);b.prevAll(".step-title:first").hasClass("step-active")?a.go_to_next_step():b.nextAll(".step-title:first").hasClass("step-active")?
a.go_to_prev_step():(b=b.prevAll(".step-title"),a.go_to_step(b.length+1))})):b=="never"&&(d.css("cursor","default"),a.on("click",".step-title.step-active:not(.step-notraverse)",function(){var b=f(this).prevAll(".step-title");a.go_to_step(b.length+1)}));d.filter(".step-notraverse").css("cursor","default")};a.trigger_error=function(b){b=b.prevAll(".step-content").length+1;b=a.find(".step-title").eq(b-1);b.hasClass("step-warning")?(b.removeClass("btn-info btn-success").addClass("btn-warning"),c.check_marks&&
b.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> ')):b.hasClass("step-error")&&(b.removeClass("btn-info btn-success").addClass("btn-danger"),c.check_marks&&b.find("i.step-mark").remove().end().prepend('<i class="icon-remove step-mark"></i> '))};h.hide().first().addClass("step-visited step-active").show();p.addClass("disabled btn").first().addClass("step-visited step-active").removeClass("disabled");c.step_names||o.hide();a.change_traverse(c.traverse_titles);a.check_progress_titles();
c.content_headings&&a.make_step_content_headings();var g;c.start_incomplete_step?(h=a.find(".step-title.step-info-incomplete").first(),h.length?a.go_to_step(h.prevAll(".step-title").length+1):(g=a.find(".step-title.btn-success").last(),a.go_to_step(g.prevAll(".step-title").length+1))):c.start_warning_step?(h=a.find(".step-title.step-info-warning").first(),h.length?a.go_to_step(h.prevAll(".step-title").length+1):(g=a.find(".step-title.btn-success").last(),a.go_to_step(g.prevAll(".step-title").length+
1))):c.start_error_step?(h=a.find(".step-title.step-info-error").first(),h.length?a.go_to_step(h.prevAll(".step-title").length+1):(g=a.find(".step-title.btn-success").last(),a.go_to_step(g.prevAll(".step-title").length+1))):a.go_to_step(c.step_start);i.click(function(){if(c.use_custom_back_button){var b=a.find(".step-title.step-active").prevAll(".step-title").length;c.custom_back_button_click.call(void 0,b)}else a.go_to_prev_step()});var s=0;a.bind("validate.psteps",function(b){b.timeStamp<s+500?
(b.preventDefault(),b.stopPropagation()):(s=b.timeStamp,a.check_progress_titles())});a.bind("traverse_never.psteps",function(){a.change_traverse("never")});a.bind("traverse_always.psteps",function(){a.change_traverse("always")});a.bind("traverse_visited.psteps",function(){a.change_traverse("visited")});a.bind("traverse_custom.psteps",function(){a.change_traverse("custom")});a.bind("load_after_steps.psteps",function(){c.load_after_steps.call(a)});a.on("step_error.psteps",".step-content",function(){a.trigger_error(f(this))});
a.on("go_to_step.psteps",".step-title",function(){var b=f(this).prevAll(".step-title");a.go_to_step(b.length+1)});a.bind("go_to_first_incomplete.psteps",function(){var b=a.find(".step-title.step-info-incomplete").first();b.length?a.go_to_step(b.prevAll(".step-title").length+1):(g=a.find(".step-title.btn-success").last(),a.go_to_step(g.prevAll(".step-title").length+1))});a.bind("go_to_first_warning.psteps",function(){var b=a.find(".step-title.step-info-warning").first();b.length?a.go_to_step(b.prevAll(".step-title").length+
1):(g=a.find(".step-title.btn-success").last(),a.go_to_step(g.prevAll(".step-title").length+1))});a.bind("go_to_first_error.psteps",function(){var b=a.find(".step-title.step-info-error").first();b.length?a.go_to_step(b.prevAll(".step-title").length+1):(g=a.find(".step-title.btn-success").last(),a.go_to_step(g.prevAll(".step-title").length+1))});l.click(function(b){var e=f(this);if(e.hasClass(c.btn_wait_class))setTimeout(function(){a.trigger("validate.psteps");var d=a.find(".step-title.step-active");
d.hasClass("step-error")&&c.validate_errors&&!c.validate_next_step?c.validate_use_error_msg?alert(c.validate_error_msg):d.click():d.hasClass("step-error")&&c.validate_next_step&&!c.ignore_errors_on_next?f.noop():d.hasClass("step-error")&&c.ignore_errors_on_next?a.go_to_next_step():e.hasClass("btn-success")?a.go_to_next_step():e.hasClass("submit-button")&&(c.validate_submit_all_steps||c.validate_next_step)?(c.use_before_submit&&alert(c.before_submit),b.preventDefault()):c.validate_next_step&&c.use_before_next?
alert(c.before_next):a.go_to_next_step()},c.btn_wait_time);else{a.trigger("validate.psteps");var d=a.find(".step-title.step-active");d.hasClass("step-error")&&c.validate_errors&&!c.validate_next_step?c.validate_use_error_msg?alert(c.validate_error_msg):d.click():d.hasClass("step-error")&&c.validate_next_step&&!c.ignore_errors_on_next?f.noop():d.hasClass("step-error")&&c.ignore_errors_on_next?a.go_to_next_step():e.hasClass("btn-success")?a.go_to_next_step():e.hasClass("submit-button")&&(c.validate_submit_all_steps||
c.validate_next_step)?(c.use_before_submit&&alert(c.before_submit),b.preventDefault()):c.validate_next_step&&c.use_before_next?alert(c.before_next):a.go_to_next_step()}});this.pines_steps=a});return this};f.fn.psteps.defaults={traverse_titles:"never",custom_traverse_class:"custom-traverse",skip_no_traverse_on_next:true,content_headings:false,content_headings_element:"h4",content_headings_hr:true,content_headings_after:false,step_order:true,step_names:true,check_marks:true,alter_width_at_viewport:"1000",
steps_width_percentage:false,steps_height_equalize:false,content_height_equalize:false,alter_names_at_viewport:"650",shrink_step_names:true,back:true,use_custom_back_button:false,custom_back_button_click:function(){},step_start:"1",steps_onload:function(){},steps_show:function(){},steps_hide:function(){},steps_transition:function(){},start_incomplete_step:false,start_warning_step:false,start_error_step:false,validation_rule:function(){return true},validate_next_step:true,validate_submit_all_steps:true,
validate_errors:true,ignore_errors_on_next:false,ignore_errors_on_submit:false,validate_error_msg:"There was an error processing the step.",validate_use_error_msg:true,use_before_submit:true,before_submit:"Please complete all of the required steps before submitting.",use_before_next:true,before_next:"Please complete this step before advancing to the next step.",btn_wait_class:"btn-wait",btn_wait_time:1E3,load_after_steps:function(){}}})(jQuery);
